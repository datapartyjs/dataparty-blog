<!DOCTYPE html>
<html lang="en" >
  <head>
  <title>Wtf is a kdf? | blog.dataparty</title>
  <meta charset='utf-8'>

  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto+Condensed" type="text/css" media="all" />
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto" type="text/css" media="all" />
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto+Mono" type="text/css" media="all" />
  
  
  <style>
    body {
        font-family: 'Roboto\2b Condensed';
    }
    #brand-font {
       font-family: 'Roboto\2b Condensed'; 
    }
    </style>

  <meta name="viewport" content ="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">


  
  
<meta name="keywords" content="blog.dataparty">
<meta property="og:locale" content='en_US'>
<meta property="og:type" content="article">
<meta property="og:title" content="WTF is a KDF? ">
<meta property="og:description" content="Earlier this week a letter from an activist imprisoned in France was posted to the internet. Contained within Ivan Alococo’s dispatch from the Villepinte prison">
<meta property="og:url" content="https://blog.dataparty.xyz/blog/wtf-is-a-kdf/">
<meta property="og:image" content="https://blog.dataparty.xyz/images/kdf-images/prison-flames.jpg"><meta property="article:published_time" content="2023-22-04" />
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "BlogPosting",
      "mainEntityOfPage":"https:\/\/blog.dataparty.xyz\/blog\/wtf-is-a-kdf\/",
      "name": "blog.dataparty",
      "headline": "WTF is a KDF? ",
      "description": "Earlier this week a letter from an activist imprisoned in France was posted to the internet. Contained within Ivan Alococo’s dispatch from the Villepinte prison",
      "url": "https:\/\/blog.dataparty.xyz\/blog\/wtf-is-a-kdf\/",
      "datePublished": "2023-22-04",
      "dateModified": "2023-22-04",
      "author": {
        "@type": "Person",
        "name": "nullagent"
      },
      "image":{
        "@type":"ImageObject",
        "url": "https:\/\/blog.dataparty.xyz\/images\/kdf-images\/prison-flames.jpg"
      },
      "publisher": {
        "@type": "Organization",
        "logo": {
          "@type":"ImageObject",
          "url": "images\/%!s(\u003cnil\u003e)"
        },
        "name": "blog.dataparty"
      }
    }
  </script>
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:creator" content="@datapartydao">
  <meta name="twitter:title" content="WTF is a KDF? ">
  <meta name="twitter:description" content="Earlier this week a letter from an activist imprisoned in France was posted to the internet. Contained within Ivan Alococo’s dispatch from the Villepinte prison">
  <meta name="twitter:image" content="https://blog.dataparty.xyz/images/kdf-images/prison-flames.jpg">
<link rel="canonical" href="https://blog.dataparty.xyz/blog/wtf-is-a-kdf/">
<link rel="apple-touch-icon" sizes="180x180" href='https://blog.dataparty.xyz/images/icons/apple-touch-icon.png'>
<link rel="icon" type="image/png" sizes="32x32" href='https://blog.dataparty.xyz/images/icons/favicon-32x32.png'>
<link rel="icon" type="image/png" sizes='16x16' href='https://blog.dataparty.xyz/images/icons/favicon-16x16.png'>
<link rel="manifest" href='https://blog.dataparty.xyz/images/icons/site.webmanifest'>

<link rel="stylesheet" href="https://blog.dataparty.xyz/css/styles.4496df4ae254b5eb04c454975aca2cc8b004d655d284718adbc75303a7fd9dbdfcc2294deb77165d38c00a4cb74f60a1a71c9023aa01a184ec975306f3a5893d.css" integrity="sha512-RJbfSuJUtesExFSXWsosyLAE1lXShHGK28dTA6f9nb38wilN63cWXTjACky3T2ChpxyQI6oBoYTsl1MG86WJPQ==">
</head>

  <body>
    <div class="nav-drop">
  <div class="nav-body">
      <a href="https://dataparty.xyz" class="nav_item">About</a>
      <a href="https://blog.dataparty.xyz/" class="nav_item">Blog</a>
      <a href="https://blog.dataparty.xyz/categories" class="nav_item">Category</a>
      <a href="https://blog.dataparty.xyz/tags" class="nav_item">Tag</a>
    <div class="nav-close"></div><div class="color_mode">
<label for="mode">Toggle Dark Mode</label>
<input type="checkbox" class="color_choice" id="mode">
</div>

  </div>
</div>
<header class="nav">
  <nav class="nav-menu">
    <a href="https://blog.dataparty.xyz/" class="nav-brand brand-font nav_item">blog.dataparty</a>
    <div class="nav_bar-wrap">
      <div class="nav_bar"></div>
    </div>
  </nav>
</header>


    <main>
      
  <div class="wrap mt post">
    <div><p class="post_date">22. April 2023</p>
      <h1 class="post_title">WTF is a KDF? </h1>
      <div class="post_body">
        <div class="post_inner">
        
          
          <img src="https://blog.dataparty.xyz/images/kdf-images/prison-flames.jpg" alt="kdf-images/prison-flames.jpg" class="post_thumbnail">
        
          <p>Earlier this week a letter from an activist imprisoned in France was <a href="https://nantes.indymedia.org/posts/87395/une-lettre-divan-enferme-a-la-prison-de-villepinte-perquisitions-et-disques-durs-dechiffres/">posted to the internet</a>. Contained within Ivan Alococo’s dispatch from the Villepinte prison was <a href="https://twitter.com/rechelon/status/1648094323186241536">a startling revelation</a>. Police had cracked his LUKS hard drive password. A feat that once was impossible can now be accomplished in a few months by harnessing <a href="https://kolektiva.social/@cedar/110214532879538171">as many as 10,000 servers</a> with modern GPUs. At the root of this breach is a cryptographic function that is showing its age, PBKDF2.</p>
<p>This episode is a wake up call to learn wtf is a KDF?</p>
<h2 id="what-is-a-kdf">What is a KDF?</h2>
<p>In modern computing when applications provide strong file encryption they frequently use passwords to protect files. For passwords to be strong they must contain a lot of entropy and generally appear as random as possible. Obviously humans tend to use characters and phrases from their native language combined with memorable patterns or rules that help them remember these passwords.</p>
<p>Key derivation functions (KDFs) are tools that allow us to improve the entropy derived from the types of keys and passwords applications typically use. By performing a series of hashing and salting <code>PBKDF2</code> seasons the user&rsquo;s input with entropy sufficient for use in private keys for algorithms like AES and NaCl.</p>
<p>Many <a href="https://crypto.stackexchange.com/a/40767">types of KDFs exist</a>. Specialized KDFs are also used to generate keys from Diffie-Helman output and cryptographic random numbers.</p>
<p>In the case of this French prisoner they were using Linux&rsquo;s most popular hard drive encryption tool, LUKS, which was using a <code>PBKDF2</code> to generate AES keys. In Ubuntu 18.04 this is the default configuration. <code>PBKDF2</code> is a password based KDF designed to be resistant to CPU based attacks and dates back to 2000. It was first mentioned as an <a href="https://www.rfc-editor.org/rfc/rfc2898#section-5.2">internet standard in RFC-2898 in September 2000</a>.</p>
<h2 id="a-startling-revelation">A startling revelation</h2>
<p>Since the time PBKDF2 was designed, we&rsquo;ve seen the rise of powerful GPUs become common place. To defend against this rising <a href="https://blog.elcomsoft.com/2020/08/breaking-luks-encryption/">onslaught of GPU hashing power</a> is a relatively new algorithm, argon2.</p>



<div class='picture float-right'>
  
  
  <figure>
  

    <picture>
      <img srcset="https://blog.dataparty.xyz/images/kdf-images/argon2-vs-pbkdf2.jpeg" alt="" >
    </picture>

    
  
    <figcaption>
      argon2 sneaks up on pbkdf2
    </figcaption>
  </figure>
  

  
</div>

<h2 id="how-does-argon2-work">How does Argon2 Work?</h2>
<p>The cryptographic power of argon2 is sublte but brilliant. Instead of focusing on CPU time by requiring large numbers of hash iterations, argon2 wages war on your GPUs memory capacity. When hashing a password with argon2 an application developer can dial up the amount of RAM that is required to complete the computation. In so doing it starves the globs of highly parallel computation cores in a GPU reducing the total processing power the GPU can bring to bear.</p>
<p>Why does this work? On modern GPUs the exact number of threads that are active in parallel varies between models and is dependent on the amount of GPU ram required per thread. Small operations on typical GPUs may see as many as 2000 threads running in parallel. Meanwhile even the largest cloud GPUs max out around 80GB of on board memory. If argon2 is configured to use 1GB to compute password hashes then even an <a href="https://www.nvidia.com/en-us/data-center/a100/">NVIDIA A100</a> would only be able to try 80 passwords in parallel instead of the orders of magnitude more cores that would be active when attacking PBKDF2 hashed passwords.</p>



<div class='picture float-right'>
  
  
  <figure>
  

    <picture>
      <img srcset="https://blog.dataparty.xyz/images/kdf-images/a100.webp" alt="" >
    </picture>

    
  
    <figcaption>
      Diagram of NVIDIA A100 GPU
    </figcaption>
  </figure>
  

  
</div>

<h2 id="argon2-and-you---">Argon2 and you . . .</h2>
<p>If you&rsquo;re a developer who builds secure apps and this is your first time hearing about argon2 its probably a good time to review your code. On nodejs check for uses of crypto.pbkdf2 that should be upgraded.</p>
<p>If you&rsquo;re a Linux user, more likely than not your LUKS partitions will already using <code>argon2id</code>. You can check by running the <code>lsblk</code> command to find the name of an active partition. Then running:</p>
<p><code>sudo cryptsetup luksDump /dev/&lt;YOUR_PARTITION_HERE&gt;</code></p>
<p>If you do happen to be using an outdated algorithm you should update it! Matthew Garrett, a Linux developer, has written a great <a href="https://mjg59.dreamwidth.org/66429.html">guide to updating old LUKS partitions</a>.</p>
<h3 id="is-pbkdf2-broken">Is PBKDF2 broken?</h3>
<p>On the face of it, no. PBKDF2 is not fundamentally broken. It&rsquo;s safe so long as the user always has <a href="https://www.reddit.com/r/linux/comments/12q51ce/comment/jgpvsqc/?utm_source=share&amp;utm_medium=web2x&amp;context=3">a 13 character or longer actually-random™ password</a>. The choice of pbkdf2 vs argon2 is of course domain and application dependant. It remains unclear exactly how authorities accessed Ivan’s hard drive.  so this is more a wake up call</p>
<h2 id="using-argon2-in-nodejs">Using argon2 in nodejs</h2>



<div class='picture float-right'>
  <a href='https://github.com/datapartyjs/dataparty-crypto/blob/master/examples/example-password-argon2.js'>
  
  <figure>
  

    <picture>
      <img srcset="https://blog.dataparty.xyz/images/kdf-images/crypto-example.png" alt="" >
    </picture>

    
  
    <figcaption>
      Example argon2 password KDF
    </figcaption>
  </figure>
  

  </a>
</div>

<p>At the hacker collective, <a href="https://dataparty.xyz">dataparty</a>, we&rsquo;ve been building a secure configuration feature that we intend to use to make a secure, decentralized database management tool. We&rsquo;d recently relied upon pbkdf2 but with the news of Ivan&rsquo;s letter from a French prison we&rsquo;ve taken the time to upgrade to argon2 in our nodejs codebases.</p>
<p>You can see how we upgraded to argon2 by <a href="https://github.com/datapartyjs/dataparty-api/issues/71">reading through this feature request</a> and the <a href="https://github.com/datapartyjs/dataparty-crypto/pull/16">PRs referenced within</a>.</p>
<h2 id="nodejs-vs-browser">Nodejs vs. Browser</h2>
<p>We had some trouble getting the nodejs focused module <a href="https://www.npmjs.com/package/argon2"><code>argon2</code></a> and the browser module <a href="https://www.npmjs.com/package/argon2-browser"><code>argon2-browser</code></a> to play nice together. Sadly these libraries do not both use the same API. We made a wrapper function in <a href="https://medium.com/r/?url=https%3A%2F%2Fgithub.com%2Fdatapartyjs%2Fdataparty-crypto"><code>@dataparty/crypto</code></a> that allows you to use the same API for both modules. We&rsquo;ve posted a complete example for nodejs usage on github:</p>
<p><a href="https://github.com/datapartyjs/dataparty-crypto/blob/master/examples/example-password-argon2.js"><code>dataparty-crypto/example-password-argon2.js</code> at master · <code>@dataparty/crypto</code></a></p>
<p>Meanwhile we&rsquo;ve added an argon2 example to our <a href="https://github.com/datapartyjs/dataparty-crypto/blob/master/examples/index.html#L98-L124">browser example</a>.</p>
<h2 id="support">Support</h2>
<p>Find this story helpful? Buy us a coffee or give a follow:</p>
<ul>
<li><a href="https://ko-fi.com/dataparty">https://ko-fi.com/dataparty</a></li>
<li><a href="https://github.com/datapartyjs">https://github.com/datapartyjs</a></li>
<li><a href="https://dataparty.xyz">https://dataparty.xyz</a></li>
<li>Join our discord <a href="https://discord.gg/JrYQ3f4Pxz">https://discord.gg/JrYQ3f4Pxz</a></li>
</ul>
<h2 id="heading"></h2>
<h2 id="changes">Changes</h2>
<p>(23-04-2023)</p>
<ul>
<li>Clarify <a href="#what-is-a-kdf">types of KDFs</a></li>
<li>Add <a href="#a-startling-revelation">link to commercial LUKS cracking cloud</a></li>
<li>Add <a href="#is-pbkdf2-broken">&ldquo;Is PBKDF2 broken?&quot;</a> section</li>
</ul>

        </div>
        <div class="post_extra mb-2">
          
<div class="copy" data-before="Share Story" data-after="Link Copied">
  <svg class="icon">
    <use xlink:href="#copy"></use>
  </svg>
</div>
        </div>
        <div>
        
        </div>
      </div>
    </div>
    <a href="https://blog.dataparty.xyz/" class="post_nav"><span class="post_next">The Latest 
      <svg class="icon icon_scale">
        <use xlink:href="#double-arrow"></use>
      </svg>
    </span></a>
  </div>

    </main>
    <footer class="footer wrap pale">
  <p class="attribution"><a href="https://dataparty.xyz">&copy;&nbsp;<span class="year"></span>&nbsp;Dataparty</a></p>
</footer>


<script src="https://blog.dataparty.xyz/js/index.min.9622b73f8cdc2afafc1f76d9c2e91a282e396720eb8906c4fecf1ef0471bfc91b454c99828de7292eee0c30676dfd24394308631e442028d97c8331b945d4a17.js"></script>

    <svg width="0" height="0" class="hidden">
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 699.428 699.428" id="copy">
    <path d="M502.714 0H240.428C194.178 0 153 42.425 153 87.429l-25.267.59c-46.228 0-84.019 41.834-84.019 86.838V612c0 45.004 41.179 87.428 87.429 87.428H459c46.249 0 87.428-42.424 87.428-87.428h21.857c46.25 0 87.429-42.424 87.429-87.428v-349.19L502.714 0zM459 655.715H131.143c-22.95 0-43.714-21.441-43.714-43.715V174.857c0-22.272 18.688-42.993 41.638-42.993l23.933-.721v393.429C153 569.576 194.178 612 240.428 612h262.286c0 22.273-20.765 43.715-43.714 43.715zm153-131.143c0 22.271-20.765 43.713-43.715 43.713H240.428c-22.95 0-43.714-21.441-43.714-43.713V87.429c0-22.272 20.764-43.714 43.714-43.714H459c-.351 50.337 0 87.975 0 87.975 0 45.419 40.872 86.882 87.428 86.882H612v306zm-65.572-349.715c-23.277 0-43.714-42.293-43.714-64.981V44.348L612 174.857h-65.572zm-43.714 131.537H306c-12.065 0-21.857 9.77-21.857 21.835 0 12.065 9.792 21.835 21.857 21.835h196.714c12.065 0 21.857-9.771 21.857-21.835 0-12.065-9.792-21.835-21.857-21.835zm0 109.176H306c-12.065 0-21.857 9.77-21.857 21.834 0 12.066 9.792 21.836 21.857 21.836h196.714c12.065 0 21.857-9.77 21.857-21.836 0-12.064-9.792-21.834-21.857-21.834z"></path>
  </symbol>
  <symbol viewBox="0 0 53 42" xmlns="http://www.w3.org/2000/svg" id="double-arrow">
    <path d="M.595 39.653a1.318 1.318 0 0 1 0-1.864L16.55 21.833a1.318 1.318 0 0 0 0-1.863L.595 4.014a1.318 1.318 0 0 1 0-1.863L2.125.62a1.318 1.318 0 0 1 1.864 0l19.35 19.349a1.318 1.318 0 0 1 0 1.863l-19.35 19.35a1.318 1.318 0 0 1-1.863 0zm29 0a1.318 1.318 0 0 1 0-1.864L45.55 21.833a1.318 1.318 0 0 0 0-1.863L29.595 4.014a1.318 1.318 0 0 1 0-1.863l1.53-1.53a1.318 1.318 0 0 1 1.864 0l19.35 19.349a1.318 1.318 0 0 1 0 1.863l-19.35 19.35a1.318 1.318 0 0 1-1.863 0z"></path>
  </symbol>
</svg>
  </body>
</html>
